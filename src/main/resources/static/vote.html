<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Vote</title>
    <script>
     window.addEventListener('load', (event) => {
       document.querySelectorAll(".vote").forEach(button =>
         button.addEventListener("click", handleButtonClick('/api' + window.location.pathname))
       )

       function handleButtonClick(url) {
         return (event) => {
           // Disable buttons
           document
             .querySelectorAll('.btn')
             .forEach(b => b.disabled = 'disabled');

           fetch(url, {
             method: 'POST',
             headers: {
               'Content-Type': 'application/json'
             },
             body: event.currentTarget.dataset.rating
           }).then(
             (res) => res.status < 400
               ? showResult('Thank you!')
               : showResult('Error', 'red'),
             () => showResult('Error', 'red')
           );
         };
       }

       function showResult(message, color) {
         // Hide buttons
         document
           .querySelectorAll('.btn')
           .forEach(b => b.style.display = 'none');

         const result = document.querySelector('.result')
         result.textContent = message;
         result.style.display = 'inline';
         if (color) {
           result.style.color = color;
         }
       }
     });
    </script>

    <style>
      html {
        height: 100%;
      }
      body {
        min-height: 100%;
        display: flex;
        margin: 0;
        padding: 0;
        font-family: sans-serif;
      }

      .container {
        flex: 1;
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 0 15%;
      }

      @media (max-width: 800px) {
        .container {
          padding: 0 5%;
        }
      }

     .btn {
       padding: 10px;
       border: 0;
       border-radius: 50%;
       overflow: hidden;
       cursor: pointer;
       width: 15%;
     }
     .btn:hover {
       box-shadow: 0px 0px 30px #3FA8E0;
     }
     .btn:active {
       box-shadow: 0px 0px 15px #3b7bbe;
     }
     .btn:disabled {
       box-shadow: none;
       opacity: 0.5;
       cursor: default;
     }
     .btn[data-rating="1"] {
       background-color: red;
     }
     .btn[data-rating="2"] {
       background-color: orange;
     }
     .btn[data-rating="3"] {
       background-color: gold;
     }
     .btn[data-rating="4"] {
       background-color: chartreuse;
     }
     .btn[data-rating="5"] {
       background-color: springgreen;
     }
     .btn img {
       display: block;
       width: 100%;
     }

     .result {
       font-size: 10rem;
     }
    </style>
  </head>

  <body>
    <main class="container">
      <button class="vote btn" data-rating="1"><img src="./frown-regular.svg" alt="Rating 1" /></button>
      <button class="vote btn" data-rating="2"><img src="./frown-open-regular.svg" alt="Rating 2" /></button>
      <button class="vote btn" data-rating="3"><img src="./meh-regular.svg" alt="Rating 3" /></button>
      <button class="vote btn" data-rating="4"><img src="./grin-regular.svg" alt="Rating 4" /></button>
      <button class="vote btn" data-rating="5"><img src="./laugh-regular.svg" alt="Rating 5" /></button>
      <p class="result" style="display: none"></p>
    </main>
  </body>
</html>
